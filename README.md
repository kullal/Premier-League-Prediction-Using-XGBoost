# Premier League Match Prediction using XGBoost

This project builds an XGBoost model to predict the outcomes of English Premier League (EPL) matches.

## Project Structure

```
/Dataset EPL New/
    EPL 2022-2023.csv
    EPL 2023-2024.csv
    EPL 2024-2025.csv
    ... (other season data)

/Combined Dataset/
    combined_epl_data.csv   (Generated by combine_data.py - though script was deleted, file is used)
    X_train.csv             (Generated by preprocess_data.py)
    y_train.csv             (Generated by preprocess_data.py)
    X_test.csv              (Generated by preprocess_data.py)
    y_test.csv              (Generated by preprocess_data.py)
    label_encoders.joblib   (Generated by preprocess_data.py)

/models/
    best_params.json        (Generated by tune_xgboost_model.py)
    xgboost_epl_model.json  (Generated by train_xgboost_model.py)
    confusion_matrix_test.png (Generated by train_xgboost_model.py)
    feature_importances.png (Generated by train_xgboost_model.py)

preprocess_data.py        # Cleans data, engineers features, splits data, saves processed files & encoders.
combine_data.py           # (DELETED - Original script to combine seasonal CSVs into combined_epl_data.csv)
                          # combined_epl_data.csv should be manually prepared or generated if needed.
tune_xgboost_model.py     # Performs hyperparameter tuning using RandomizedSearchCV and saves best parameters.
train_xgboost_model.py    # Trains the final XGBoost model with best params, saves the model, and evaluates it.
predict_match.py          # Predicts outcome for a single new match provided as a dictionary input.
predict_future_matchup.py # Predicts specific matchups from EPL 2024-2025.csv using user input for teams.
README.md                 # This file.
```

## Workflow & How to Run Scripts

**Prerequisites:**
*   Python 3.x
*   Libraries: pandas, scikit-learn, xgboost, joblib, matplotlib, seaborn
    (You can usually install these using pip: `pip install pandas scikit-learn xgboost joblib matplotlib seaborn`)

**Step 0: Data Preparation (Manual/One-time)**
1.  Ensure you have your seasonal EPL CSV files (e.g., `EPL 2022-2023.csv`, etc.) in the `/Dataset EPL New/` directory.
2.  **Crucially, you need `combined_epl_data.csv` in the `/Combined Dataset/` directory.**
    *   The original `combine_data.py` script was deleted. If `combined_epl_data.csv` doesn't exist or needs updating, you will need to manually combine your seasonal CSVs from `/Dataset EPL New/` into this single file. Ensure the column names and date formats are consistent across all files before combining.
    *   The `combined_epl_data.csv` is used by `preprocess_data.py` and also by `predict_match.py` and `predict_future_matchup.py` for calculating historical team statistics.

**Step 1: Preprocessing Data**
*   Run `preprocess_data.py` to clean the `combined_epl_data.csv`, perform feature engineering (including historical team stats), handle encodings, and split the data into training and testing sets. It will save `X_train.csv`, `y_train.csv`, `X_test.csv`, `y_test.csv`, and `label_encoders.joblib` into the `/Combined Dataset/` folder.
    ```bash
    python preprocess_data.py
    ```

**Step 2: Hyperparameter Tuning**
*   Run `tune_xgboost_model.py` to find the best hyperparameters for the XGBoost model using `RandomizedSearchCV` on the `X_train.csv` data. The best parameters found will be saved to `/models/best_params.json`.
    ```bash
    python tune_xgboost_model.py
    ```

**Step 3: Training the Final Model**
*   Run `train_xgboost_model.py`. This script will:
    1.  Load the best hyperparameters from `/models/best_params.json`.
    2.  Train the XGBoost model on the full `X_train.csv` and `y_train.csv`.
    3.  Save the trained model to `/models/xgboost_epl_model.json`.
    4.  Evaluate the model on `X_test.csv` and print accuracy, classification report, and save confusion matrix/feature importance plots to the `/models/` directory.
    ```bash
    python train_xgboost_model.py
    ```

**Step 4: Making Predictions**

*   **Option A: Predict a Single Arbitrary Match (`predict_match.py`)**
    *   Modify the `new_match_data` dictionary within the `if __name__ == "__main__":` block of `predict_match.py` with the details of the match you want to predict (HomeTeam, AwayTeam, Referee, Date, relevant odds, etc.).
    *   This script requires `combined_epl_data.csv` to calculate historical stats for the teams involved up to the match date.
    *   Run the script:
        ```bash
        python predict_match.py
        ```
    *   It will output the predicted outcome (Home Win, Draw, Away Win) and probabilities.

*   **Option B: Predict Specific Future Matchups from `EPL 2024-2025.csv` (`predict_future_matchup.py`)**
    *   Ensure `EPL 2024-2025.csv` is present in the `/Dataset EPL New/` directory and contains the fixtures you are interested in (including columns like Date, HomeTeam, AwayTeam, Referee, and any available odds).
    *   This script also requires `combined_epl_data.csv` for historical stats.
    *   Run the script. It will prompt you to enter the Home Team and Away Team names.
        ```bash
        python predict_future_matchup.py
        ```
    *   It will search for the specified matchup(s) in `EPL 2024-2025.csv`, calculate necessary features, and predict the outcome.
    *   If the `EPL 2024-2025.csv` also contains actual results (FTR, FTHG, FTAG) for the match, the script will display them alongside the prediction for cross-checking.

## Notes

*   The accuracy of the model is around 51-52% based on the latest tuning. EPL prediction is notoriously difficult!
*   Feature importance consistently shows betting odds as the most influential features.
*   The `clean_feature_name` function is critical and must be consistent across `preprocess_data.py`, `predict_match.py`, and `predict_future_matchup.py` to ensure column names align between training and prediction.
*   When predicting for new matches, ensure the input data (especially team names and referee names) matches the naming convention used in the original training data to ensure correct encoding. The prediction scripts have basic handling for unseen categorical values but this can impact accuracy.
*   The historical data (`combined_epl_data.csv`) should be kept up-to-date if you want the historical features (form, avg goals) to be relevant for current predictions. 